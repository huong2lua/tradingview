//@version=6
indicator('LÃºa MACD', shorttitle = 'LÃºa MACD', format = format.price, precision = 2)

// Tham sá»‘ Ä‘áº§u vÃ o
fastMA = input.int(12, 'Fast MA', minval = 1)
slowMA = input.int(26, 'Slow MA', minval = 1)

// MACD hiá»‡n táº¡i vÃ  trÆ°á»›c Ä‘Ã³
[currMacd, _, _] = ta.macd(close[0], fastMA, slowMA, 9)
[prevMacd, _, _] = ta.macd(close[1], fastMA, slowMA, 9)

// MÃ u histogram 4 mÃ u (pháº£i Ä‘á»ƒ 1 dÃ²ng)
plotColor = currMacd > 0 ? currMacd > prevMacd ? color.new(color.rgb(0, 255, 0), 35) : color.new(color.rgb(0, 128, 0), 35) : currMacd < prevMacd ? color.new(color.rgb(128, 0, 0), 35) : color.new(color.rgb(255, 0, 0), 35)

// Váº½ MACD histogram vÃ  Ä‘Æ°á»ng 0
plot(currMacd, style = plot.style_histogram, color = plotColor, linewidth = 3, title = 'MACD Histogram')
plot(0, title = 'Zero Line', linewidth = 1, color = color.gray)

// ---------------------------
// âš¡ Cáº£nh bÃ¡o khi MACD Ä‘á»•i mÃ u (chá»‰ khi náº¿n Ä‘Ã³ng)
// ---------------------------

// XÃ¡c Ä‘á»‹nh tráº¡ng thÃ¡i mÃ u hiá»‡n táº¡i
isUpStrong = currMacd > 0 and currMacd > prevMacd // lime
isUpWeak = currMacd > 0 and currMacd <= prevMacd // green
isDownWeak = currMacd <= 0 and currMacd >= prevMacd // maroon
isDownStrong = currMacd < 0 and currMacd < prevMacd // red

// Khi MACD Ä‘á»•i nhÃ³m mÃ u (so vá»›i trÆ°á»›c Ä‘Ã³)
colorChanged = isUpStrong and not isUpStrong[1] or isUpWeak and not isUpWeak[1] or isDownWeak and not isDownWeak[1] or isDownStrong and not isDownStrong[1]

// Chá»‰ bÃ¡o khi náº¿n Ä‘Ã³ng
alertOnClose = colorChanged and barstate.isconfirmed

if alertOnClose
    // Táº¡o text & JSON gá»­i Telegram â€” táº¥t cáº£ trÃªn 1 dÃ²ng Ä‘á»ƒ khÃ´ng lá»—i
    trendType = (isUpStrong ? "mua máº¡nh ðŸŸ¢" : isUpWeak ? "mua yáº¿u ðŸ“ˆ" : isDownWeak ? "bÃ¡n yáº¿u ðŸŸ " : isDownStrong ? "bÃ¡n máº¡nh ðŸ”»" : "khÃ´ng xÃ¡c Ä‘á»‹nh â“")
    txt2send = str.tostring(syminfo.ticker) + " " + timeframe.period + "m" + " lá»±c " + trendType

    alertMessage = '{"chat_id":"5978153872","text":"' + txt2send + '"}'

    // Gá»­i webhook
    alert(alertMessage, freq=alert.freq_once_per_bar_close)
    

// Táº¡o Ä‘iá»u kiá»‡n cáº£nh bÃ¡o
alertcondition(alertOnClose, title = 'MACD Ä‘á»•i mÃ u', message = '{"chat_id":"5978153872","text":"your text here"}')
